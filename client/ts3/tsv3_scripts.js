function setChipGalleryLength(){var e=$(document).height()-$("#chip-gallery").offset().top-5;$("#chip-gallery").css("height",e)}function getData(e,t,a,s,o,i){$.getJSON(getUrls(e).selectedSpec).done(function(t){origData=t,n_chips=origData.length,lastIndex=n_chips-1,data={Values:[]},allData={Values:[]};for(var i=[],n=0;n_chips>n;n++)data.Values.push(parseSpectralData(origData,n)),i.push(origData[n].image_year);var r=d3.max(i)+1;defaultDomain.year.max=r,currentDomain.year.max=r,data=calcIndices(data),rgbColor=scaledRGB(data,a,s,o,stretch,2,n_chips),data=calcDecDate(data),currentDomain.hasCustomizedXY||updateStretch();for(var l=[],c=[],n=0;n_chips>n;n++)l.push(getUrls(e,origData[n].image_year).annualSpec),c.push(0);l.forEach(function(t,n){$.getJSON(t).done(function(t){for(var r=0;r<t.length;r++)allData.Values.push(parseSpectralData(t,r));c[n]=1,d3.sum(c)==n_chips&&(allData=calcIndices(allData),allDataRGBcolor=scaledRGB(allData,a,s,o,stretch,2,allData.Values.length),allData=calcDecDate(allData),allDecdate=[],allData.Values.forEach(function(e){allDecdate.push(e.decDate)}),$.getJSON(getUrls(e).plotInterp).done(function(t){if(!(t.length>0&&t[0].plotid!=e.plotID)){if(vertInfo=[],t.forEach(function(e){vertInfo.push({year:e.image_year,julday:e.image_julday,index:i.indexOf(e.image_year),landUse:{primary:{landUse:e.dominant_landuse,notes:parseNote(e.dominant_landuse_notes,"landuse")},secondary:{landUse:e.secondary_landuse,notes:parseNote(e.secondary_landuse_notes,"landuse")}},landCover:{landCover:e.dominant_landcover,other:parseNote(e.dominant_landcover_notes,"landcover")},changeProcess:{changeProcess:e.change_process,notes:parseNote(e.change_process_notes,"process")}})}),$.getJSON(getUrls(e).plotComment).done(function(e){$("#commentInput").val(e.comment)}),0!=vertInfo.length)for(var a=0;a<vertInfo.length;a++)selectThese.push(vertInfo[a].index);else{selectThese=[0,lastIndex];for(var a=0;a<selectThese.length;a++)vertInfo.push({year:origData[selectThese[a]].image_year,julday:origData[selectThese[a]].image_julday,index:selectThese[a],landUse:{primary:{landUse:"",notes:{wetland:!1,mining:!1,rowCrop:!1,orchardTreeFarm:!1,vineyardsOtherWoody:!1}},secondary:{landUse:"",notes:{wetland:!1,mining:!1,rowCrop:!1,orchardTreeFarm:!1,vineyardsOtherWoody:!1}}},landCover:{landCover:"",other:{trees:!1,shrubs:!1,grassForbHerb:!1,impervious:!1,naturalBarren:!1,snowIce:!1,water:!1}},changeProcess:{changeProcess:"",notes:{natural:!1,prescribed:!1,sitePrepFire:!1,airphotoOnly:!1,clearcut:!1,thinning:!1,flooding:!1,reserviorLakeFlux:!1,wetlandDrainage:!1}}})}fillInForm(),plotInt(),appendSrcImg(),appendChips("annual",selectThese),$("#img-gallery").imagesLoaded(function(){if(makeChipInfo("json",origData),drawAllChips("annual"),null!=expandedChipWindow&&0==expandedChipWindow.closed){var e=$("#selectedColor").prop("value"),t={action:"init_chips",selectThese:selectThese,chipInfo:chipInfo,n_chips:n_chips,chipDisplayProps:chipDisplayProps,selectedColor:e};expandedChipWindow.postMessage(JSON.stringify(t),"*")}})}}))})})})}function addProjectData(e){$.getJSON(getUrls(e).projectList).done(function(e){for(var t=0;t<e.length;t++)$("#projectList").append('<li value="'+e[t].project_id+'">'+e[t].project_code+"</li>")})}function getUrls(e,t){var a="http://timesync.forestry.oregonstate.edu/_ts3",s={annualSpec:a+"/data/"+e.userID+"/"+e.projectID+"/"+e.tsa+"/"+e.plotID+"/"+t,selectedSpec:a+"/data/"+e.userID+"/"+e.projectID+"/"+e.tsa+"/"+e.plotID,projectList:a+"/project/"+e.userID,plotInterp:a+"/index.php/vertex/"+e.userID+"/"+e.projectID+"/"+e.tsa+"/"+e.plotID,plotComment:a+"/comment/"+e.userID+"/"+e.projectID+"/"+e.tsa+"/"+e.plotID,plotList:a+"/plot/"+e.userID+"/"+e.projectID+"/"+e.tsa,respDesign:a+"/config/response/"+e.projectID,chipOverRide:a+"/image/override",vertInfoSave:a+"/vertex/save",commentSave:a+"/comment/save"};return s}function parseSpectralData(e,t){var a={Year:e[t].image_year,doy:e[t].image_julday,B1:parseInt(e[t].b1)/1e4,B2:parseInt(e[t].b2)/1e4,B3:parseInt(e[t].b3)/1e4,B4:parseInt(e[t].b4)/1e4,B5:parseInt(e[t].b5)/1e4,B7:parseInt(e[t].b7)/1e4};return a}function checkPlot(e,t){var a=t.length;if(!(0==a|""==e.plotID)){var s=0;t.forEach(function(e){s+=""!=e.changeProcess.changeProcess?1:0,s+=""!=e.landUse.primary.landUse?1:0,s+=""!=e.landCover.landCover?1:0});var o=$("#plotList li.selected"),i=!1;return s+1==3*a?(o.find("span").removeClass().addClass("glyphicon glyphicon-ok"),i=!0):o.find("span").removeClass().addClass("glyphicon glyphicon-none"),i}}function clearThePlotDisplay(e,t){if(saveVertInfo(e,t),$("#chip-gallery, #img-gallery, #svg").empty(),$(".segment, .vertex").remove(),$("#commentInput").val(""),null!=chipstripwindow&&0==chipstripwindow.closed){var a={action:"clearChips"};chipstripwindow.postMessage(JSON.stringify(a),"*")}timeLapseIndex=0,selectedCircles=[],lineData=[],selectThese=[],t=[]}function appendPlots(e){$("#projBtn").empty().append(e.projectCode+'<span class="caret projBtn"></span>'),$("#plotList").empty(),$.getJSON(getUrls(e).plotList).done(function(e){for(var t=0;t<e.length;t++)1==e[t].is_complete?$("#plotList").append('<li><small><span class="glyphicon glyphicon-ok" style="margin-right:3px"></span></small>'+e[t].plotid+"</li>"):$("#plotList").append('<li><small><span class="glyphicon glyphicon-none" style="margin-right:3px"></span></small>'+e[t].plotid+"</li>");$("#toolTipsCheck").hasClass("glyphicon-ok")&&($("#plotList li").prop("title","This is a plot selector. Clicking on it will load the plot's spectral time series data and the corresponding image chips. Each time you select a new plot the display properties of the previous plot will be saved for the session. Segmentation and vertex interpretations will also be saved."),$("#plotList li").find("span").prop("title","This is a plot complete indicator. A checkmark will appear when a plot's interpretation is complete."))})}function saveSetting(e,t,a){1==a.dirty&&localStorage.setItem(e+"."+t,JSON.stringify(a))}function getSetting(e,t,a){var s=JSON.parse(localStorage.getItem(e+"."+t));return null===s&&(s=$.extend(!0,{},a),s.hasCustomizedXY=0),s}function parseNote(e,t){var a={wetland:!1,mining:!1,rowCrop:!1,orchardTreeFarm:!1,vineyardsOtherWoody:!1},s={trees:!1,shrubs:!1,grassForbHerb:!1,impervious:!1,naturalBarren:!1,snowIce:!1,water:!1},o={natural:!1,prescribed:!1,sitePrepFire:!1,airphotoOnly:!1,clearcut:!1,thinning:!1,flooding:!1,reserviorLakeFlux:!1,wetlandDrainage:!1},i=a;if("landcover"==t?i=s:"process"==t&&(i=o),""==e.trim())return i;var n=e.split("|");return n.forEach(function(e){i[e]=!0}),i}function zoomUpdate(){xyzoom=d3.behavior.zoom().scaleExtent([1,1]).y(yscale).x(xscale).on("zoom",zoomDraw),xzoom=d3.behavior.zoom().x(xscale).on("zoom",zoomDraw),yzoom=d3.behavior.zoom().y(yscale).on("zoom",zoomDraw),xybox.call(xyzoom).on("dblclick.zoom",null),xbox.call(xzoom).on("dblclick.zoom",null),ybox.call(yzoom).on("dblclick.zoom",null),currentDomain[specIndex].min=xscale.domain()[0],currentDomain[specIndex].max=xscale.domain()[1],currentDomain[specIndex].min=yscale.domain()[0],currentDomain[specIndex].max=yscale.domain()[1],currentDomain.year.min=xscale.domain()[0],currentDomain.year.max=xscale.domain()[1],currentDomain.dirty=1,currentDomain.hasCustomizedXY=1}function zoomDraw(){svg.select(".y.axis").call(yaxis),svg.selectAll("circle").attr("cx",function(e){return xscale(e.decDate)}).attr("cy",function(e){return yscale(e[specIndex])}),svg.select(".x.axis").call(xaxis),svg.selectAll("#plotLine").attr("d",lineFunction(lineData)),svg.selectAll(".vline").attr("x1",function(e){return xscale(e)}).attr("x2",function(e){return xscale(e)}),zoomUpdate()}function plotInt(){plotDrawn=1;var e=$("#allPointsDisplayThumb").hasClass("glyphicon-thumbs-down");if(0==e)var t="visible",a=.5;else var t="hidden",a=1;for(var s=$("#plot").width(),o=[],i=0;i<defaultDomain.year.max-defaultDomain.year.min;i+=2)o.push(defaultDomain.year.min+i+.49);for(var n=[],i=defaultDomain.year.min;i<=defaultDomain.year.max;i++)n.push(i);var r=250,l=10,c=15,d=65,p=28;xscale=d3.scale.linear().domain([currentDomain.year.min,currentDomain.year.max]).range([d,s-c]),yscale=d3.scale.linear().domain([currentDomain[specIndex].min,currentDomain[specIndex].max]).range([r-p,l]),xaxis=d3.svg.axis().scale(xscale).orient("bottom").tickValues(o).tickFormat(d3.format(".4r")).outerTickSize(0),yaxis=d3.svg.axis().tickSize(-s+c+d,0).scale(yscale).orient("left"),xyzoom=d3.behavior.zoom().scaleExtent([1,1]).y(yscale).x(xscale).on("zoom",zoomDraw),xzoom=d3.behavior.zoom().x(xscale).on("zoom",zoomDraw),yzoom=d3.behavior.zoom().y(yscale).on("zoom",zoomDraw),svg=d3.select("#svg"),lineFunction=d3.svg.line().x(function(e){return xscale(e.x)}).y(function(e){return yscale(e.y)}).interpolate("linear"),xybox=svg.append("rect").attr("class","zoom xy box").attr("id","xybox").attr("x",d).attr("y",l).attr("width",s-d-c).attr("height",r-l-p).style("visibility","hidden").attr("pointer-events","all").call(xyzoom).on("dblclick.zoom",null);var h=svg.selectAll(".vline").data(n).enter().append("line").attr("x1",function(e){return xscale(e)}).attr("x2",function(e){return xscale(e)}).attr("y1",function(e){return-2e4}).attr("y2",function(e){return 2e4}).attr("class","vline");svg.append("g").attr("class","y axis").attr("transform","translate("+d+",0)").call(yaxis),allCircles=svg.selectAll(".allData").data(allData.Values).enter().append("circle").attr("visibility",t).style("fill",function(e,t){return allDataRGBcolor[t]}).attr("cx",function(e){return xscale(e.decDate)}).attr("cy",function(e){return yscale(e[specIndex])}).attr("r",3).attr("class","allData");var m=.0085*s;circles=svg.selectAll(".data").data(data.Values).enter().append("circle").style("fill-opacity",a).style("fill",function(e,t){return rgbColor[t]}).attr("cx",function(e){return xscale(e.decDate)}).attr("cy",function(e){return yscale(e[specIndex])}).attr("r",m).attr("class","data unselected"),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(r-p)+")").call(xaxis),svg.append("text").attr("transform","rotate(-90)").attr("x",(r-p)/-2).attr("y",15).style("text-anchor","middle").text(ylabel).attr("id","specPlotIndex"),svg.append("defs").append("clipPath").attr("id","clip").append("rect").attr("x",70).attr("y",10).attr("width",s-c-d).attr("height",r-p-l),xbox=svg.append("rect").attr("class","zoom x box").attr("id","xbox").attr("x",d).attr("y",r-p).attr("width",s-d-c).attr("height",p).style("visibility","hidden").attr("pointer-events","all").call(xzoom).on("dblclick.zoom",null),ybox=svg.append("rect").attr("class","zoom y box").attr("id","ybox").attr("y",l).attr("width",d).attr("height",r-l-p).style("visibility","hidden").attr("pointer-events","all").call(yzoom).on("dblclick.zoom",null),$("#toolTipsCheck").hasClass("glyphicon glyphicon-ok")?(d3.selectAll("circle.data").append("svg:title").text("This is an annual spectral time series point. It is the spectral return for the pixel at the plot center for the day selected to represent this year in the annual time series. Hovering over it will activate a green highlight outline that corresponds to the green highlight outline of the matched image chip in the chip gallery. The highlighting feature makes it easy to know which point belongs to which image chip. Doubling clicking the point will toggle it as a vertex. The first and last points cannot be toggled."),d3.selectAll("circle.allData").append("svg:title").text("This is an intra-annual spectral time series point. It is the spectral return for the pixel at the plot center for one of all days selected to represent a year in the annual time series. It will be highlighted blue when hovering over an image chip in the intra-annual chip window as a correspondence marking feature. These points are helpful for determining the intra-annual variability of plots and can help make a more informed decision about whether to place a vertex or change the default annual point/image chip."),d3.selectAll("#xbox").append("svg:title").text("This is the x-axis. Click and hold to drag the scale to the left or right and mouse wheel to zoom in and out."),d3.selectAll("#ybox").append("svg:title").text("This is the y-axis. Click and hold to drag the scale up or down and mouse wheel to zoom in and out.")):(d3.selectAll("circle.data").append("svg:title").text(""),d3.selectAll("circle.allData").append("svg:title").text(""),d3.selectAll("#xbox").append("svg:title").text(""),d3.selectAll("#ybox").append("svg:title").text(""));for(var u=$("circle.data"),i=0;i<selectThese.length;i++)u.eq(selectThese[i]).attr("class","data selected"),lineData.push({x:data.Values[selectThese[i]].decDate,y:data.Values[selectThese[i]][specIndex]});var g=svg.append("path").attr("d",lineFunction(lineData)).attr("id","plotLine");circles.attr("clip-path","url(#clip)"),allCircles.attr("clip-path","url(#clip)"),g.attr("clip-path","url(#clip)"),h.attr("clip-path","url(#clip)");for(var v=$("circle.data.selected"),i=0;i<v.length;i++)selectedCircles.push(u.index(v[i]));setSelectedColor(),"glyphicon glyphicon-thumbs-down"==$("#lineDisplayThumb").attr("class")&&($("circle.selected").css("stroke-opacity","0"),$("circle.highlight").css("stroke-opacity","0"),$("#plotLine").css("stroke-opacity","0"))}function updateStretch(){var e=["B1","B2","B3","B4","B5","B7","TCB","TCG","TCW","TCA","NDVI","NBR"];e.map(function(e){var t=d3.min(data.Values,function(t){return t[e]}),a=d3.max(data.Values,function(t){return t[e]}),s=.1*(a-t);t-=s,a+=s,currentDomain[e].min=t,currentDomain[e].max=a})}function plotUpdate(e,t,a,s){yscale.domain([s[t].min,s[t].max]),zoomUpdate(),svg.selectAll("circle.allData").data(allData.Values).transition().duration(500).attr("cy",function(e){return yscale(e[t])}).style("fill",function(e,t){return allDataRGBcolor[t]}),svg.selectAll("circle.data").data(e.Values).transition().duration(500).attr("cy",function(e){return yscale(e[t])}).style("fill",function(e,t){return a[t]});for(var o=0;o<selectedCircles.length;o++){var i=selectedCircles[o];lineData[o]={x:e.Values[i].decDate,y:e.Values[i][t]}}svg.selectAll("#plotLine").transition().duration(500).attr("d",lineFunction(lineData)),svg.select(".y.axis").transition().duration(500).call(yaxis)}function updatePlotRGB(){svg.selectAll("circle.data").transition().duration(500).style("fill",function(e,t){return rgbColor[t]}),svg.selectAll("circle.allData").transition().duration(500).style("fill",function(e,t){return allDataRGBcolor[t]})}function changePlotPoint(){svg.selectAll("circle.data").data(data.Values).transition().duration(500).attr("cx",function(e){return xscale(e.decDate)}).attr("cy",function(e){return yscale(e[specIndex])}).style("fill",function(e,t){return rgbColor[t]});for(var e=0;e<selectedCircles.length;e++){var t=selectedCircles[e];lineData[e]={x:data.Values[t].decDate,y:data.Values[t][specIndex]}}svg.selectAll("#plotLine").transition().duration(500).attr("d",lineFunction(lineData))}function changePlotLine(){var e=$("circle.selected");lineData=[],selectedCircles=[];for(var t=0;t<e.length;t++){var a=$("circle.data").index(e[t]);selectedCircles.push(a),lineData.push({x:data.Values[a].decDate,y:data.Values[a][specIndex]})}$("#plotLine").remove(),lineGraph=svg.append("path").attr("d",lineFunction(lineData)).attr("id","plotLine").attr("clip-path","url(#clip)")}function localStretch(){var e=d3.min(data.Values,function(e){return e[specIndex]}),t=d3.max(data.Values,function(e){return e[specIndex]}),a=.1*(t-e);e-=a,t+=a,currentDomain[specIndex].min=e,currentDomain[specIndex].max=t,svg.call(xzoom.x(xscale.domain([defaultDomain.year.min,defaultDomain.year.max])).y(yscale.domain([currentDomain[specIndex].min,currentDomain[specIndex].max])).event),svg.call(yzoom.x(xscale.domain([defaultDomain.year.min,defaultDomain.year.max])).y(yscale.domain([currentDomain[specIndex].min,currentDomain[specIndex].max])).event)}function changeSelectedClass(e){var t=$("circle.data").eq(e),a=$(".chipHolder").eq(e),s=t.attr("class");"data unselected"==s?(t.attr("class","data selected"),a.addClass("selected"),updateSegmentForm(e,"add")):(t.attr("class","data unselected"),t.css("stroke","none"),a.removeClass("selected"),a.css("border-color","white"),updateSegmentForm(e,"remove")),changePlotLine(),setSelectedColor(),circleBorderColor=t.css("stroke"),t.css({stroke:highLightColor,"stroke-width":5}).attr("id","hover"),a.addClass("hover"),borderColor=a.css("borderTopColor"),a.css({borderTopColor:highLightColor,borderRightColor:highLightColor,borderBottomColor:highLightColor,borderLeftColor:highLightColor})}function calcColor(e,t,a,s,o){for(var e=$.extend(!0,{},e),i=a[t].mean-a[t].stdev*s,n=a[t].mean+a[t].stdev*s,r=[],l=0;o>l;l++)e.Values[l][t]<i&&(e.Values[l][t]=i),e.Values[l][t]>n&&(e.Values[l][t]=n),r[l]=(e.Values[l][t]-i)/(n-i)*256;return r}function scaledRGB(e,t,a,s,o,i,n){for(var r=calcColor(e,t,o,i,n),l=calcColor(e,a,o,i,n),c=calcColor(e,s,o,i,n),d=[],p=0;n>p;p++)d[p]=d3.rgb(r[p],l[p],c[p]);return d}function calcIndices(e){var t=e.Values.length,a=0,s=0,o=0,i=0,n=0,r=0,l=[.2043,.4158,.5524,.5741,.3124,.2303],c=[-.1603,-.2819,-.4934,.794,-2e-4,-.1446],d=[.0315,.2021,.3102,.1594,-.6806,-.6109],p=0;for(p;t>p;p++)a=e.Values[p].B1,s=e.Values[p].B2,o=e.Values[p].B3,i=e.Values[p].B4,n=e.Values[p].B5,r=e.Values[p].B7,e.Values[p].TCB=a*l[0]+s*l[1]+o*l[2]+i*l[3]+n*l[4]+r*l[5],e.Values[p].TCG=a*c[0]+s*c[1]+o*c[2]+i*c[3]+n*c[4]+r*c[5],e.Values[p].TCW=a*d[0]+s*d[1]+o*d[2]+i*d[3]+n*d[4]+r*d[5],e.Values[p].TCA=Math.atan(e.Values[p].TCG/e.Values[p].TCB)*(180/Math.PI),e.Values[p].NBR=(i-r)/(i+r),e.Values[p].NDVI=(i-o)/(i+o);return e}function leapYear(e){return e%4==0&&e%100!=0||e%400==0}function calcDecDate(e){for(var t=0;t<e.Values.length;t++){var a=e.Values[t].Year;if(leapYear(a))var s=367;else var s=366;var o=a+e.Values[t].doy/s;e.Values[t].decDate=o}return e}function setHighlightColor(){highLightColor=$("#highlightColor").prop("value"),$("circle.highlight").css({stroke:highLightColor,"stroke-width":5}),$(".chipHolder.highlight").css("border-color",highLightColor),$("tr.active").css("background-color",highLightColor)}function setSelectedColor(){var e=$("#selectedColor").prop("value");$("circle.selected").css("stroke",e),$("#plotLine").css("stroke",e),$(".chipHolder.selected").css("border-color",e)}function saveVertInfo(e,t){if(!("undefined"==typeof t|""==e.projectID|""==e.plotID)&&e.isDirty){var a={vertInfo:t,projectID:e.projectID,userID:e.userID,plotID:e.plotID,tsa:e.tsa};a=JSON.stringify(a),$.post(getUrls(e).vertInfoSave,{vertInfoSave:a}).fail(function(){alert("Failed to save vertInfo")});var s=$("#commentInput").val(),o=1==checkPlot(e,t)?1:0,i={projectID:e.projectID,tsa:e.tsa,plotID:e.plotID,userID:e.userID,comment:s,isComplete:o};i=JSON.stringify(i),$.post(getUrls(e).commentSave,{comment:i}).fail(function(){alert("Failed to save plot comment")}),e.isDirty=!1}}function appendCPnotes(e){switch(e){case"Fire":$("#fire").addClass("selected"),$(".forFire").closest("li").removeClass("disabled"),$(".forFire").attr("disabled",!1);break;case"Harvest":$("#harvest").addClass("selected"),$(".forHarvest").closest("li").removeClass("disabled"),$(".forHarvest").attr("disabled",!1);break;case"Decline":$("#decline").addClass("selected"),$(".forDecline").closest("li").removeClass("disabled"),$(".forDecline").attr("disabled",!1);break;case"Wind":$("#wind").addClass("selected"),$(".forWind").closest("li").removeClass("disabled"),$(".forWind").attr("disabled",!1);break;case"Hydrology":$("#hydro").addClass("selected"),$(".forHydro").closest("li").removeClass("disabled"),$(".forHydro").attr("disabled",!1);break;case"Debris":$("#debris").addClass("selected"),$(".forDebris").closest("li").removeClass("disabled"),$(".forDebris").attr("disabled",!1);break;case"Growth":$("#growth").addClass("selected"),$(".forGrowth").closest("li").removeClass("disabled"),$(".forGrowth").attr("disabled",!1);break;case"Stable":$("#stable").addClass("selected"),$(".forStable").closest("li").removeClass("disabled"),$(".forStable").attr("disabled",!1);break;case"Conversion":$("#conversion").addClass("selected"),$(".forConserv").closest("li").removeClass("disabled"),$(".forConserv").attr("disabled",!1);break;case"Other":$("#otherCP").addClass("selected"),$(".forOther").closest("li").removeClass("disabled"),$(".forOther").attr("disabled",!1)}}function appendLUnotes(e,t){switch(e){case"Forest":"primary"==t?($("#landUseList .forest").addClass("selected"),$("#LUnotesList .forForest").attr("disabled",!1),$("#LUnotesList .forForest").closest("li").removeClass("disabled")):($("#landUseListSec .forest").addClass("selected"),$("#LUnotesListSec .forForest").attr("disabled",!1),$("#LUnotesListSec .forForest").closest("li").removeClass("disabled"));break;case"Developed":"primary"==t?($("#landUseList .developed").addClass("selected"),$("#LUnotesList .forDeveloped").attr("disabled",!1),$("#LUnotesList .forDeveloped").closest("li").removeClass("disabled")):($("#landUseListSec .developed").addClass("selected"),$("#LUnotesListSec .forDeveloped").attr("disabled",!1),$("#LUnotesListSec .forDeveloped").closest("li").removeClass("disabled"));break;case"Agriculture":"primary"==t?($("#landUseList .ag").addClass("selected"),$("#LUnotesList .forAg").attr("disabled",!1),$("#LUnotesList .forAg").closest("li").removeClass("disabled")):($("#landUseListSec .ag").addClass("selected"),$("#LUnotesListSec .forAg").attr("disabled",!1),$("#LUnotesListSec .forAg").closest("li").removeClass("disabled"));break;case"Non-forest Wetland":"primary"==t?($("#landUseList .nonForWet").addClass("selected"),$("#LUnotesList .forForest").attr("disabled",!1),$("#LUnotesList .forForest").closest("li").removeClass("disabled")):($("#landUseListSec .nonForWet").addClass("selected"),$("#LUnotesListSec .forForest").attr("disabled",!1),$("#LUnotesListSec .forForest").closest("li").removeClass("disabled"));break;case"Rangeland":"primary"==t?($("#landUseList .rangeland").addClass("selected"),$("#LUnotesList .forDeveloped").attr("disabled",!1),$("#LUnotesList .forDeveloped").closest("li").removeClass("disabled")):($("#landUseListSec .rangeland").addClass("selected"),$("#LUnotesListSec .forDeveloped").attr("disabled",!1),$("#LUnotesListSec .forDeveloped").closest("li").removeClass("disabled"));break;case"Other":"primary"==t?($("#landUseList .otherLU").addClass("selected"),$("#LUnotesList .forAg").attr("disabled",!1),$("#LUnotesList .forAg").closest("li").removeClass("disabled")):($("#landUseListSec .otherLU").addClass("selected"),$("#LUnotesListSec .forAg").attr("disabled",!1),$("#LUnotesListSec .forAg").closest("li").removeClass("disabled"))}}function appendLCnotes(e){switch(e){case"Trees":$("#treesLC").addClass("selected"),$("#shrubs,#grassForbHerb,#impervious,#naturalBarren,#snowIce,#water").closest("li").removeClass("disabled"),$("#shrubs,#grassForbHerb,#impervious,#naturalBarren,#snowIce,#water").attr("disabled",!1);break;case"Shrubs":$("#shrubsLC").addClass("selected"),$("#trees,#grassForbHerb,#impervious,#naturalBarren,#snowIce,#water").closest("li").removeClass("disabled"),$("#trees,#grassForbHerb,#impervious,#naturalBarren,#snowIce,#water").attr("disabled",!1);break;case"Grass/forb/herb":$("#gfhLC").addClass("selected"),$("#trees,#shrubs,#impervious,#naturalBarren,#snowIce,#water").closest("li").removeClass("disabled"),$("#trees,#shrubs,#impervious,#naturalBarren,#snowIce,#water").attr("disabled",!1);break;case"Impervious":$("#imperviousLC").addClass("selected"),$("#trees,#shrubs,#grassForbHerb,#naturalBarren,#snowIce,#water").closest("li").removeClass("disabled"),$("#trees,#shrubs,#grassForbHerb,#naturalBarren,#snowIce,#water").attr("disabled",!1);break;case"Natural barren":$("#natBarLC").addClass("selected"),$("#trees,#shrubs,#impervious,#grassForbHerb,#snowIce,#water").closest("li").removeClass("disabled"),$("#trees,#shrubs,#impervious,#grassForbHerb,#snowIce,#water").attr("disabled",!1);break;case"Snow/ice":$("#snowIceLC").addClass("selected"),$("#trees,#shrubs,#impervious,#naturalBarren,#grassForbHerb,#water").closest("li").removeClass("disabled"),$("#trees,#shrubs,#impervious,#naturalBarren,#grassForbHerb,#water").attr("disabled",!1);break;case"Water":$("#waterLC").addClass("selected"),$("#trees,#shrubs,#impervious,#naturalBarren,#snowIce,#grassForbHerb").closest("li").removeClass("disabled"),$("#trees,#shrubs,#impervious,#naturalBarren,#snowIce,#grassForbHerb").attr("disabled",!1)}}function changeProcessDoneBtn(){$("#changeProcessDiv").hide(),highlightOff();var e=$(".changeProcessInput").index($(".changeProcessInput.active"))+1,t=$("td.changeProcessInput.active").text();vertInfo[e].changeProcess.changeProcess=t,vertInfo[e].changeProcess.notes.natural=$("#natural").prop("checked"),vertInfo[e].changeProcess.notes.prescribed=$("#prescribed").prop("checked"),vertInfo[e].changeProcess.notes.sitePrepFire=$("#sitePrepFire").prop("checked"),vertInfo[e].changeProcess.notes.airphotoOnly=$("#airphotoOnly").prop("checked"),vertInfo[e].changeProcess.notes.clearcut=$("#clearcut").prop("checked"),vertInfo[e].changeProcess.notes.thinning=$("#thinning").prop("checked"),vertInfo[e].changeProcess.notes.flooding=$("#flooding").prop("checked"),vertInfo[e].changeProcess.notes.reserviorLakeFlux=$("#reserviorLakeFlux").prop("checked"),vertInfo[e].changeProcess.notes.wetlandDrainage=$("#wetlandDrainage").prop("checked")}function landUseDoneBtn(){highlightOff();var e=$(".landUseInput").index($(".landUseInput.active"));vertInfo[e].landUse.primary.landUse=$("td.landUseInput.active").text();var t=$("#landUseListSec .selected");vertInfo[e].landUse.secondary.landUse=t.text(),t.removeClass("selected"),vertInfo[e].landUse.primary.notes.wetland=$("#LUnotesList .wetland").prop("checked"),vertInfo[e].landUse.primary.notes.mining=$("#LUnotesList .mining").prop("checked"),vertInfo[e].landUse.primary.notes.rowCrop=$("#LUnotesList .rowCrop").prop("checked"),vertInfo[e].landUse.primary.notes.orchardTreeFarm=$("#LUnotesList .orchardTreeFarm").prop("checked"),vertInfo[e].landUse.primary.notes.vineyardsOtherWoody=$("#LUnotesList .vineyardsOtherWoody").prop("checked"),vertInfo[e].landUse.secondary.notes.wetland=$("#LUnotesListSec .wetland").prop("checked"),vertInfo[e].landUse.secondary.notes.mining=$("#LUnotesListSec .mining").prop("checked"),vertInfo[e].landUse.secondary.notes.rowCrop=$("#LUnotesListSec .rowCrop").prop("checked"),vertInfo[e].landUse.secondary.notes.orchardTreeFarm=$("#LUnotesListSec .orchardTreeFarm").prop("checked"),vertInfo[e].landUse.secondary.notes.vineyardsOtherWoody=$("#LUnotesListSec .vineyardsOtherWoody").prop("checked")}function landCoverDoneBtn(){highlightOff();var e=$(".landCoverInput").index($(".landCoverInput.active")),t=$("td.landCoverInput.active").text();vertInfo[e].landCover.landCover=t,vertInfo[e].landCover.other.trees=$("#trees").prop("checked"),vertInfo[e].landCover.other.shrubs=$("#shrubs").prop("checked"),vertInfo[e].landCover.other.grassForbHerb=$("#grassForbHerb").prop("checked"),vertInfo[e].landCover.other.impervious=$("#impervious").prop("checked"),vertInfo[e].landCover.other.naturalBarren=$("#naturalBarren").prop("checked"),vertInfo[e].landCover.other.snowIce=$("#snowIce").prop("checked"),vertInfo[e].landCover.other.water=$("#water").prop("checked"),$("#LCnotesList .selected").removeClass("selected")}function fillInForm(){var e=selectThese.length;$(".segment, vertex").remove();for(var t=0;e-1>t;t++){var a=vertInfo[t].year,s=vertInfo[t+1].year;$("#segmentsFormTbl").append('<tr class="segment"><td class="highlightIt"><span class="glyphicon glyphicon-search"></span></td><td>'+a+"</td><td>"+s+'</td><td class="changeProcessInput formDrop"></td></tr>'),$(".changeProcessInput").eq(t).text(vertInfo[t+1].changeProcess.changeProcess)}for(t=0;e>t;t++)a=vertInfo[t].year,$("#verticesFormTbl").append('<tr class="vertex"><td class="highlightIt"><span class="glyphicon glyphicon-search"></span></td><td>'+a+'</td><td class="landUseInput formDrop lulc"></td><td class="landCoverInput formDrop lulc"></td></tr>'),$(".landUseInput").eq(t).text(vertInfo[t].landUse.primary.landUse),$(".landCoverInput").eq(t).text(vertInfo[t].landCover.landCover)}function updateSegmentForm(e,t){if("add"==t){for(var a=0;a<vertInfo.length&&!(vertInfo[a].index>e);a++);var s={year:data.Values[e].Year,julday:data.Values[e].doy,index:e,landUse:{primary:{landUse:"",notes:{wetland:!1,mining:!1,rowCrop:!1,orchardTreeFarm:!1,vineyardsOtherWoody:!1}},secondary:{landUse:"",notes:{wetland:!1,mining:!1,rowCrop:!1,orchardTreeFarm:!1,vineyardsOtherWoody:!1}}},landCover:{landCover:"",other:{trees:!1,shrubs:!1,grassForbHerb:!1,impervious:!1,naturalBarren:!1,snowIce:!1,water:!1}},changeProcess:{changeProcess:"",notes:{natural:!1,prescribed:!1,sitePrepFire:!1,airphotoOnly:!1,clearcut:!1,thinning:!1,flooding:!1,reserviorLakeFlux:!1,wetlandDrainage:!1}}};vertInfo.splice(a,0,s),selectThese.splice(a,0,e)}else if("remove"==t){var o=selectThese.indexOf(e);vertInfo.splice(o,1),selectThese.splice(o,1)}$(".segment").remove(),$(".vertex").remove(),fillInForm()}function dropInputLists(e,t,a,s,o){var i=e.position(),n=i.top,r=i.left,l=e[0].getBoundingClientRect().width,c=e[0].getBoundingClientRect().height;$("#"+t).css({position:"absolute",top:n+parseFloat(c)+s,left:r+a,width:parseFloat(l)+o+"px"}).show()}function changeNoteIcon(e,t,a){switch(a){case"landUse":$("#LUnotesList .wetland").prop("checked",vertInfo[t].landUse.primary.notes.wetland),$("#LUnotesList .mining").prop("checked",vertInfo[t].landUse.primary.notes.mining),$("#LUnotesList .rowCrop").prop("checked",vertInfo[t].landUse.primary.notes.rowCrop),$("#LUnotesList .orchardTreeFarm").prop("checked",vertInfo[t].landUse.primary.notes.orchardTreeFarm),$("#LUnotesList .vineyardsOtherWoody").prop("checked",vertInfo[t].landUse.primary.notes.vineyardsOtherWoody);break;case"landUseSec":$("#LUnotesListSec .wetland").prop("checked",vertInfo[t].landUse.secondary.notes.wetland),$("#LUnotesListSec .mining").prop("checked",vertInfo[t].landUse.secondary.notes.mining),$("#LUnotesListSec .rowCrop").prop("checked",vertInfo[t].landUse.secondary.notes.rowCrop),$("#LUnotesListSec .orchardTreeFarm").prop("checked",vertInfo[t].landUse.secondary.notes.orchardTreeFarm),$("#LUnotesListSec .vineyardsOtherWoody").prop("checked",vertInfo[t].landUse.secondary.notes.vineyardsOtherWoody);break;case"landCover":$("#trees").prop("checked",vertInfo[t].landCover.other.trees),$("#shrubs").prop("checked",vertInfo[t].landCover.other.shrubs),$("#grassForbHerb").prop("checked",vertInfo[t].landCover.other.grassForbHerb),$("#impervious").prop("checked",vertInfo[t].landCover.other.impervious),$("#naturalBarren").prop("checked",vertInfo[t].landCover.other.naturalBarren),$("#snowIce").prop("checked",vertInfo[t].landCover.other.snowIce),$("#water").prop("checked",vertInfo[t].landCover.other.water);break;case"changeProcess":$("#natural").prop("checked",vertInfo[t].changeProcess.notes.natural),$("#prescribed").prop("checked",vertInfo[t].changeProcess.notes.prescribed),$("#sitePrepFire").prop("checked",vertInfo[t].changeProcess.notes.sitePrepFire),$("#airphotoOnly").prop("checked",vertInfo[t].changeProcess.notes.airphotoOnly),$("#clearcut").prop("checked",vertInfo[t].changeProcess.notes.clearcut),$("#thinning").prop("checked",vertInfo[t].changeProcess.notes.thinning),$("#flooding").prop("checked",vertInfo[t].changeProcess.notes.flooding),$("#reserviorLakeFlux").prop("checked",vertInfo[t].changeProcess.notes.reserviorLakeFlux),$("#wetlandDrainage").prop("checked",vertInfo[t].changeProcess.notes.wetlandDrainage)}}function highlightOff(){$("circle.data.highlight").attr("class","data selected").css({stroke:highLightColor,"stroke-width":2}),$(".chipHolder.highlight").addClass("selected").removeClass("highlight"),$("tr.active").removeClass("active").css("background-color","white"),$("circle").css("cursor","pointer"),$(".chipImg").css("cursor","pointer"),setSelectedColor()}function highlightOn(e,t){switch(e){case"vertex":var a=vertInfo[t].index;$("circle.data:eq("+a+")").attr("class","data highlight"),$(".chipHolder:eq("+a+")").removeClass("selected").addClass("highlight");break;case"segment":
var s=vertInfo[t-1].index,o=vertInfo[t].index;$("circle.data:eq("+s+")").attr("class","data highlight"),$("circle.data:eq("+o+")").attr("class","data highlight"),$(".chipHolder:eq("+s+")").removeClass("selected").addClass("highlight"),$(".chipHolder:eq("+o+")").removeClass("selected").addClass("highlight")}$("circle").css("cursor","not-allowed"),$(".chipImg").css("cursor","not-allowed"),setHighlightColor()}function closeDropAndRecord(){$("#luLevelSwitchHolder li").removeClass("selected").css({"font-weight":"normal"}),$("#LUprimaryTab").addClass("selected").css({"font-weight":"bold"}),$("#landUseListSec").hide(),$("#landUseList").show(),$("#LUnotesListSec").hide(),$("#LUnotesList").show();var e=$("td.active");0!=e.length&&(sessionInfo.isDirty=!0,e.hasClass("changeProcessInput")?changeProcessDoneBtn():e.hasClass("lulc")&&($("#lulc").hide(),landUseDoneBtn(),landCoverDoneBtn()),e.removeClass("active"))}function appendSrcImg(){for(var e=0;n_chips>e;e++){chipInfo.imgIDs[e]="img"+e;var t='<img class="chipImgSrc" id="'+chipInfo.imgIDs[e]+'"src="'+origData[e].url+'">';$("#img-gallery").append(t)}}function appendChips(e,t,a){for(var s=0;n_chips>s;s++){chipInfo.canvasIDs[s]="chip"+s;var o='<div id="'+chipInfo.canvasIDs[s]+'" class="chipHolder"><canvas class="chipImg" width="'+chipDisplayProps.chipSize+'" height="'+chipDisplayProps.canvasHeight+'"></canvas><div class="chipDate">&nbsp;</div></div>';$("#chip-gallery").append(o)}if("annual"==e){$(".chipHolder, .chipImg, .chipImgSrc").addClass("annual");for(var s=0;s<t.length;s++)$(".chipHolder").eq(t[s]).addClass("selected");setSelectedColor()}else if("intraAnnual"==e){$(".chipHolder, .chipImg, .chipImgSrc").addClass("intraAnnual");for(var s=0;s<t.length;s++)$(".chipHolder").eq(t[s]).addClass("selected")}$("#toolTipsCheck").hasClass("glyphicon glyphicon-ok")&&($("canvas.chipImg.annual").prop("title","This is an annual image chip. It represents the 255 x 255 pixel image subset centered on the plot. There is one image per year and the center pixel outlined in white corresponds to a spectral point in the pixel time series. The correspondence between this image chip and its mathcing point in the spectral point time series is marked by shared green highlighting on hover. Holding the shift key while mouse wheeling on an image chip will change the scale. Double clicking on an image chip will toggle a vertex on and off. Image chips that are outlined in red represent vertices."),$("span.expandChipYear").prop("title","This is intra-annual image chip window icon. Clicking it will open a new window and/or load all image chips for the year. In the intra-annual image chip window, all chips have a corresponding intra-annual spectral point in the time series plot. Hovering over any of the image chips while the Show Points (show intra-annual points) toggle is active (thumbs up), the corresponding point will be highlighted in blue. This will help you make a decision about which point is best suited to represent the year. Clicking on any of the image chips will set that chip as the new data for the year. The data will immediately change in the main chip gallery and in the spectral time series plot."),$(".chipDate").prop("title","This is the year and day of the image chip and corresponding point in the spectral time series plot. The day is defined by day-of-year. In the Help button dropdown menu there is a conversion calendar that links day-of-year to month-day to help interpret when the image was recorded."))}function makeChipInfo(e,t){for(var a=0;n_chips>a;a++){var s=document.getElementById(chipInfo.imgIDs[a]),o=s.naturalHeight/255;if("random"==e)var i=Math.floor(Math.random()*o);else if("ordered"==e)var i=a;else if("json"==e)var i=0,n=t[a].image_year,r=t[a].image_julday,l=t[a].url;chipInfo.chipsInStrip[a]=o,chipInfo.useThisChip[a]=i,chipInfo.year[a]=n,chipInfo.julday[a]=r,chipInfo.src[a]=l}updateChipInfo()}function updateChipInfo(){for(var e=0;n_chips>e;e++)chipInfo.sxOrig[e]=chipDisplayProps.offset,chipInfo.syOrig[e]=255*chipInfo.useThisChip[e]+chipDisplayProps.offset,chipInfo.sWidthOrig[e]=chipDisplayProps.chipSize,chipInfo.sxZoom[e]=chipInfo.sxOrig[e],chipInfo.syZoom[e]=chipInfo.syOrig[e],chipInfo.sWidthZoom[e]=chipInfo.sWidthOrig[e];for(var t=chipDisplayProps.halfChipSize,a=chipDisplayProps.box,e=1;maxZoom+1>e;e++)t*=.9,sAdj[e]=chipDisplayProps.halfChipSize-t,a/=.9,lwAdj[e]=a}function tlPlay(){var e=$(".chipImgSrc").eq(timeLapseIndex)[0];tlctx.drawImage(e,chipInfo.sxZoom[timeLapseIndex],chipInfo.syZoom[timeLapseIndex],chipInfo.sWidthZoom[timeLapseIndex],chipInfo.sWidthZoom[timeLapseIndex],0,0,235,235),tlctx.strokeStyle=chipDisplayProps.plotColor,tlctx.lineWidth=1,tlctx.lineCap="square",tlctx.strokeRect(117.5-chipDisplayProps.boxZoom/2,117.5-chipDisplayProps.boxZoom/2,chipDisplayProps.boxZoom,chipDisplayProps.boxZoom),$("#tlDate").text(data.Values[timeLapseIndex].Year),lastIndex>timeLapseIndex?timeLapseIndex+=1:timeLapseIndex=0}function tlFlicker(){var e=$(".chipImgSrc").eq(timeLapseIndex)[0];tlctx.drawImage(e,chipInfo.sxZoom[timeLapseIndex],chipInfo.syZoom[timeLapseIndex],chipInfo.sWidthZoom[timeLapseIndex],chipInfo.sWidthZoom[timeLapseIndex],0,0,235,235),tlctx.strokeStyle=chipDisplayProps.plotColor,tlctx.lineWidth=1,tlctx.lineCap="square",tlctx.strokeRect(117.5-chipDisplayProps.boxZoom/2,117.5-chipDisplayProps.boxZoom/2,chipDisplayProps.boxZoom,chipDisplayProps.boxZoom),$("#tlDate").text(data.Values[timeLapseIndex].Year),"forward"==flickerDir?(timeLapseIndex-=1,flickerDir="back"):(timeLapseIndex+=1,flickerDir="forward"),timeLapseIndex>lastIndex&&(timeLapseIndex=0),0>timeLapseIndex&&(timeLapseIndex=lastIndex)}function drawTLimage(){var e=$(".chipImgSrc").eq(timeLapseIndex)[0];tlctx.drawImage(e,chipInfo.sxZoom[timeLapseIndex],chipInfo.syZoom[timeLapseIndex],chipInfo.sWidthZoom[timeLapseIndex],chipInfo.sWidthZoom[timeLapseIndex],0,0,235,235),tlctx.strokeStyle=chipDisplayProps.plotColor,tlctx.lineWidth=1,tlctx.lineCap="square",tlctx.strokeRect(117.5-chipDisplayProps.boxZoom/2,117.5-chipDisplayProps.boxZoom/2,chipDisplayProps.boxZoom,chipDisplayProps.boxZoom)}function drawAllChips(e){updateZoom();for(var t=0;n_chips>t;t++)drawOneChip(t,e)}function drawOneChip(e,t){var a=$(".chipImgSrc."+t).eq(e)[0],s=$(".chipImg."+t).eq(e)[0],o=s.getContext("2d");o.clearRect(0,0,s.width,s.height),o.mozImageSmoothingEnabled=!1,o.webkitImageSmoothingEnabled=!1,o.msImageSmoothingEnabled=!1,o.imageSmoothingEnabled=!1,o.drawImage(a,chipInfo.sxZoom[e],chipInfo.syZoom[e],chipInfo.sWidthZoom[e],chipInfo.sWidthZoom[e],0,0,chipDisplayProps.chipSize,chipDisplayProps.chipSize),o.strokeStyle=chipDisplayProps.plotColor,o.lineWidth=1,o.lineCap="square",o.strokeRect(chipDisplayProps.halfChipSize-chipDisplayProps.boxZoom/2,chipDisplayProps.halfChipSize-chipDisplayProps.boxZoom/2,chipDisplayProps.boxZoom,chipDisplayProps.boxZoom),"annual"==t?($(".chipDate").eq(e).empty().append(chipInfo.year[e]+"-"+chipInfo.julday[e]+'<span class="glyphicon glyphicon-new-window expandChipYear" aria-hidden="true" style="float:right; margin-right:5px"></span>'),$("#toolTipsCheck").hasClass("glyphicon glyphicon-ok")&&$("span.expandChipYear").prop("title","This is intra-annual image chip window icon. Clicking it will open a new window and/or load all image chips for the year. In the intra-annual image chip window, all chips have a corresponding intra-annual spectral point in the time series plot. Hovering over any of the image chips while the Show Points (show intra-annual points) toggle is active (thumbs up), the corresponding point will be highlighted in blue. This will help you make a decision about which point is best suited to represent the year. Clicking on any of the image chips will set that chip as the new data for the year. The data will immediately change in the main chip gallery and in the spectral time series plot.")):"intraAnnual"==t&&$(".chipDate").eq(e).empty().append(chipInfo.year[e]+"-"+chipInfo.julday[e])}function replaceChip(e){var t=e.originChipIndex,a=$(".chipImgSrc").eq(t);a.attr("src",chipInfo.src[t]),chipInfo.useThisChip[t]=e.useThisChip,chipInfo.syOrig[t]=255*chipInfo.useThisChip[t]+chipDisplayProps.offset,chipInfo.syZoom[t]=chipInfo.syOrig[t]+sAdj[chipDisplayProps.zoomLevel],drawOneChip(t,"annual")}function updateZoom(){for(var e=0;n_chips>e;e++)chipInfo.sxZoom[e]=chipInfo.sxOrig[e]+sAdj[chipDisplayProps.zoomLevel],chipInfo.syZoom[e]=chipInfo.syOrig[e]+sAdj[chipDisplayProps.zoomLevel],chipInfo.sWidthZoom[e]=chipInfo.sWidthOrig[e]-2*sAdj[chipDisplayProps.zoomLevel];chipDisplayProps.boxZoom=lwAdj[chipDisplayProps.zoomLevel]}function changeDefaultChip(e,t,a,s){var o={projectID:e.projectID,tsa:e.tsa,plotID:e.plotID,userID:e.userID,year:t,julday:a,oldJulday:s};o=JSON.stringify(o),$.post(getUrls(e).chipOverRide,{imagePreference:o}).fail(function(){alert("Failed to save image preference")})}function tlInt(){var e=$(".chipImgSrc").eq(timeLapseIndex)[0];tlctx.mozImageSmoothingEnabled=!1,tlctx.msImageSmoothingEnabled=!1,tlctx.imageSmoothingEnabled=!1,tlctx.drawImage(e,chipInfo.sxZoom[timeLapseIndex],chipInfo.syZoom[timeLapseIndex],chipInfo.sWidthZoom[timeLapseIndex],chipInfo.sWidthZoom[timeLapseIndex],0,0,235,235),tlctx.strokeStyle=chipDisplayProps.plotColor,tlctx.lineWidth=1,tlctx.lineCap="square",tlctx.strokeRect(117.5-chipDisplayProps.boxZoom/2,117.5-chipDisplayProps.boxZoom/2,chipDisplayProps.boxZoom,chipDisplayProps.boxZoom),$("#tlDate").text(data.Values[timeLapseIndex].Year)}$(document).ready(function(){setChipGalleryLength()});var specIndex="TCW",rgbColor=[],allDataRGBcolor=[],data={Values:[]},allData={Values:[]},n_chips=0,lastIndex=0,origData=[],selectedCircles=[],lineDate=[],vertInfo=[],selectThese=[],lineData=[],chipstripwindow=null,highLightColor="#32CD32",activeRedSpecIndex="TCB",activeGreenSpecIndex="TCG",activeBlueSpecIndex="TCW",ylabel="",sessionInfo={userID:userID,projectID:"",projectCode:"",tsa:"999999",plotID:"",isDirty:!1},chipInfo={useThisChip:[],canvasIDs:[],imgIDs:[],sxOrig:[],syOrig:[],sWidthOrig:[],sxZoom:[],syZoom:[],sWidthZoom:[],chipsInStrip:[],year:[],julday:[],src:[]},chipDisplayProps={box:1,boxZoom:1,chipSize:195,halfChipSize:97.5,offset:30,canvasHeight:195,zoomLevel:20,plotColor:"#FFFFFF"},minZoom=0,maxZoom=40,stopZoom=40,sAdj=[0],lwAdj=[chipDisplayProps.box],zoomIn=0,timeLapseIndex=0,playTL,flickerTL,windowH=$(window).height(),windowW=$(window).width();$("#projectList").load(addProjectData(sessionInfo)),$("#commentInput").keypress(function(e){sessionInfo.isDirty=!0}),$("body").on("click","#projectList li",function(){clearThePlotDisplay(sessionInfo,vertInfo),sessionInfo.projectID=$(this).val(),sessionInfo.projectCode=$(this).text(),sessionInfo.plotID="",appendPlots(sessionInfo)});var date=new Date;defaultDomain.year.max=date.getFullYear()+1;var currentDomain=$.extend(!0,{},defaultDomain);currentDomain.dirty=0,currentDomain.hasCustomizedXY=0,$("body").on("click","#plotList li",function(e){if(!(e.originalEvent.detail>1)){var t=sessionInfo.plotID;saveSetting(sessionInfo.projectID,t,currentDomain),clearThePlotDisplay(sessionInfo,vertInfo);$("#plotList li").index($(this));sessionInfo.plotID=$(this).text(),currentDomain=getSetting(sessionInfo.projectID,sessionInfo.plotID,defaultDomain),currentDomain.dirty=0,$("#plotList li").removeClass("selected"),$(this).addClass("selected"),vertInfo=[],activeRedSpecIndex=$("#redList li.active").attr("id"),activeGreenSpecIndex=$("#greenList li.active").attr("id"),activeBlueSpecIndex=$("#blueList li.active").attr("id"),specIndex=$("#indexList li.active").attr("id"),ylabel=$("#"+specIndex).text(),getData(sessionInfo,specIndex,activeRedSpecIndex,activeGreenSpecIndex,activeBlueSpecIndex,ylabel)}});var plotDrawn=0;$("#btnResetGlobal").click(function(){svg.call(xzoom.x(xscale.domain([defaultDomain.year.min,defaultDomain.year.max])).y(yscale.domain([defaultDomain[specIndex].min,defaultDomain[specIndex].max])).event),svg.call(yzoom.x(xscale.domain([defaultDomain.year.min,defaultDomain.year.max])).y(yscale.domain([defaultDomain[specIndex].min,defaultDomain[specIndex].max])).event)}),$("#btnResetLocal").click(function(){localStretch()}),$(window).resize(function(e){var t=$(window).height(),a=$(window).width();t!=windowH&&setChipGalleryLength(),a!=windowW&&1==plotDrawn&&($("#svg").empty(),selectedCircles=[],lineData=[],plotInt())}),$(document).on("dblclick","circle.data, .chipHolder.annual",function(e){if(sessionInfo.isDirty=!0,0==$("tr").hasClass("active")){e.preventDefault();var t=$(this).prop("nodeName");if("circle"==t)var a=$("circle.data").index(this);else var a=$(".chipHolder").index(this);changeSelectedClass(a)}}),$(document).on({mouseenter:function(){var e=$(this).prop("nodeName");if("circle"==e)var t=$(this),a=$("circle.data").index(t),s=$(".chipHolder.annual").eq(a);else var s=$(this),a=$(".chipHolder.annual").index(s),t=$("circle.data").eq(a);circleBorderColor=t.css("stroke"),circleBorderWidth=t.css("stroke-width"),t.css({stroke:highLightColor,"stroke-width":5}).attr("id","hover"),s.addClass("hover"),borderColor=s.css("borderTopColor"),s.css({borderTopColor:highLightColor,borderRightColor:highLightColor,borderBottomColor:highLightColor,borderLeftColor:highLightColor})},mouseleave:function(){$("#hover").css({stroke:circleBorderColor,"stroke-width":circleBorderWidth}).removeAttr("id"),$(".hover").css({borderTopColor:borderColor,borderRightColor:borderColor,borderBottomColor:borderColor,borderLeftColor:borderColor}).removeClass("hover")}},".chipHolder.annual, circle.data"),$(document).ready(function(){$(".specPlot li").click(function(){var e=$(this),t=e.closest("ul").attr("id"),a=e.attr("id"),s="#"+t+" #"+a,o="#"+t+" .active",i=$(o).attr("id"),n="#"+t+" #"+i;if($(n).removeClass("active"),$(s).addClass("active"),e.parent().hasClass("rgb")){"redList"==t?$("#btnRed div").replaceWith("<div><strong>R</strong><small>GB</small><br><small>"+$("#"+a).text()+'</small><span class="caret specPlot"></span></div>'):"greenList"==t?$("#btnGreen div").replaceWith("<div><small>R</small><strong>G</strong><small>B</small><br><small>"+$("#"+a).text()+'</small><span class="caret specPlot"></span></div>'):"blueList"==t&&$("#btnBlue div").replaceWith("<div><small>RG</small><strong>B</strong><br><small>"+$("#"+a).text()+'</small><span class="caret specPlot"></span></div>');var r=$("#redList li.active").attr("id"),l=$("#greenList li.active").attr("id"),c=$("#blueList li.active").attr("id");rgbColor=scaledRGB(data,r,l,c,stretch,2,n_chips),allDataRGBcolor=scaledRGB(allData,r,l,c,stretch,2,allData.Values.length),updatePlotRGB()}else $("#btnIndex div").replaceWith("<div><strong>Index:</strong><br><small>"+$("#"+a).text()+'</small><span class="caret specPlot"></span></div>'),specIndex=$("#indexList li.active").attr("id"),plotUpdate(data,specIndex,rgbColor,currentDomain),$("#specPlotIndex").text($("#"+specIndex).text())})}),$("#btnLine").click(function(){"glyphicon glyphicon-thumbs-up"==$("#lineDisplayThumb").attr("class")?($("#lineDisplayThumb").removeClass("glyphicon glyphicon-thumbs-up").addClass("glyphicon glyphicon-thumbs-down"),$("circle.selected").css("stroke-opacity","0"),$("circle.highlight").css("stroke-opacity","0"),$("#plotLine").css("stroke-opacity","0")):($("#lineDisplayThumb").removeClass("glyphicon glyphicon-thumbs-down").addClass("glyphicon glyphicon-thumbs-up"),$("circle.selected").css("stroke-opacity","1"),$("circle.highlight").css("stroke-opacity","1"),$("#plotLine").css("stroke-opacity","1"))}),$("#btnPoints").click(function(){"glyphicon glyphicon-thumbs-up"==$("#allPointsDisplayThumb").attr("class")?($("#allPointsDisplayThumb").removeClass("glyphicon glyphicon-thumbs-up").addClass("glyphicon glyphicon-thumbs-down"),$("circle.allData").attr("visibility","hidden"),$("circle.data").css("fill-opacity","1")):($("#allPointsDisplayThumb").removeClass("glyphicon glyphicon-thumbs-down").addClass("glyphicon glyphicon-thumbs-up"),$("circle.allData").attr("visibility","visible"),$("circle.data").css("fill-opacity","0.5"))}),$("#highlightColor").change(function(){setHighlightColor()}),$("#selectedColor").change(function(){setSelectedColor()}),$("#plotColor").change(function(){chipDisplayProps.plotColor=$("#plotColor").prop("value"),drawAllChips("annual")}),$(window).unload(function(){saveVertInfo(sessionInfo,vertInfo),null!=chipstripwindow&&0==chipstripwindow.closed&&chipstripwindow.close()}),$(window).on("beforeunload",function(){saveVertInfo(sessionInfo,vertInfo),null!=chipstripwindow&&0==chipstripwindow.closed&&chipstripwindow.close()}),$("#saveBtn").click(function(){saveVertInfo(sessionInfo,vertInfo)});var thisTRindex=0,thisTD={};$(document).ready(function(){document.oncontextmenu=function(){return!1},$(document).on("mousedown","td.formDrop",function(e){if(2==e.button){$("#contextMenu").css({left:e.pageX-115,top:e.pageY}).show(),thisTD=$(this);var t=thisTD.closest("tr");return thisTRindex=t.index(),!1}return!0})}),$("#contextMenuList li").click(function(){$("#contextMenu").hide();var e=$(this).attr("id");if("fillDown"==e){if(thisTD.hasClass("changeProcessInput")){if(thisTRindex+1>=vertInfo.length)return;for(var t=thisTRindex+1;t<vertInfo.length;t++)vertInfo[t].changeProcess=$.extend(!0,{},vertInfo[thisTRindex].changeProcess)}else if(thisTD.hasClass("landUseInput"))for(var t=thisTRindex;t<vertInfo.length;t++)vertInfo[t].landUse=$.extend(!0,{},vertInfo[thisTRindex-1].landUse);else if(thisTD.hasClass("landCoverInput"))for(var t=thisTRindex;t<vertInfo.length;t++)vertInfo[t].landCover=$.extend(!0,{},vertInfo[thisTRindex-1].landCover)}else if("copyPrev"==e)if(thisTD.hasClass("changeProcessInput")){if(thisTRindex>=vertInfo.length)return;vertInfo[thisTRindex].changeProcess=$.extend(!0,{},vertInfo[thisTRindex-1].changeProcess)}else thisTD.hasClass("landUseInput")?vertInfo[thisTRindex-1].landUse=$.extend(!0,{},vertInfo[thisTRindex-2].landUse):thisTD.hasClass("landCoverInput")&&(vertInfo[thisTRindex-1].landCover=$.extend(!0,{},vertInfo[thisTRindex-2].landCover));$(".segment, .vertex").remove(),fillInForm()}),$("html").click(function(){"block"==$("#contextMenu").css("display")&&$("#contextMenu").hide()}),$("#segmentsFormTab").click(function(){var e=$("#segmentsFormTab").attr("class");"unselected"==e&&(highlightOff(),closeDropAndRecord(),$("#CommentsFormTab, #verticesFormTab").attr("class","unselected"),$("#CommentsFormDiv, #verticesFormDiv").hide(),$("#segmentsFormTab").attr("class","selected").show(),$("#segmentsFormDiv").show())}),$("#verticesFormTab").click(function(){var e=$("#verticesFormTab").attr("class");"unselected"==e&&(highlightOff(),closeDropAndRecord(),$("#segmentsFormTab, #CommentsFormTab").attr("class","unselected"),$("#segmentsFormDiv, #CommentsFormDiv").hide(),$("#verticesFormTab").attr("class","selected").show(),$("#verticesFormDiv").show())}),$("#CommentsFormTab").click(function(){var e=$("#CommentsFormTab").attr("class");"unselected"==e&&(highlightOff(),closeDropAndRecord(),$("#segmentsFormTab, #verticesFormTab").attr("class","unselected"),$("#segmentsFormDiv, #verticesFormDiv").hide(),$("#CommentsFormTab").attr("class","selected").show(),$("#CommentsFormDiv").show())}),$(document).on("click",".changeProcessInput",function(e){highlightOff(),closeDropAndRecord();var t=$(this);t.addClass("active"),t.closest("tr").addClass("active"),$("#CPnotesList li").addClass("disabled"),$("#CPnotesList input").attr("disabled",!0),$("#changeProcessList .selected").removeClass("selected"),dropInputLists(t,"changeProcessDiv",-1,-1,1);var a=$("tr.segment .changeProcessInput").index(t)+1,s=vertInfo[a].changeProcess.changeProcess;appendCPnotes(s),changeNoteIcon("#CPnotesList",a,"changeProcess"),highlightOn("segment",a),e.stopPropagation()}),$(document).on("click",".lulc",function(e){highlightOff(),closeDropAndRecord(),$("#LUnotesList li").addClass("disabled"),$("#LUnotesListSec li").addClass("disabled"),$("#LCnotesList li").addClass("disabled"),$("#LUnotesList input").attr("disabled",!0),$("#LUnotesListSec input").attr("disabled",!0),$("#LCnotesList input").attr("disabled",!0),$("#landUseList .selected").removeClass("selected"),$("#landUseListSec .selected").removeClass("selected"),$("#landCoverList .selected").removeClass("selected");var t=$(this),a=t.closest("tr"),s=a.children(".landUseInput"),o=a.children(".landCoverInput");a.addClass("active"),s.addClass("active"),o.addClass("active");var i=$("tr.vertex").index(a);highlightOn("vertex",i);var n=vertInfo[i].landUse.primary.landUse,r=vertInfo[i].landUse.secondary.landUse,l=vertInfo[i].landCover.landCover;appendLUnotes(n,"primary"),appendLUnotes(r,"secondary"),appendLCnotes(l),changeNoteIcon("#LUnotesList",i,"landUse"),changeNoteIcon("#LUnotesListSec",i,"landUseSec"),changeNoteIcon("#LCnotesList",i,"landCover");var c=s.position(),d=(o.position(),c.top),p=c.left,h=s[0].getBoundingClientRect().height,m=s[0].getBoundingClientRect().width,u=o[0].getBoundingClientRect().width,g=m+u,v=-1,f=-1,y=1;$("#landUseDiv").css("width",parseFloat(m)-6+"px"),$("#landCoverDiv").css("width",parseFloat(u)-6+"px"),$("#lulc").css({position:"absolute",top:d+parseFloat(h)+f,left:p+v,width:parseFloat(g)+y+"px"}).show()}),$("#luLevelSwitchHolder li").click(function(){var e=$(this).attr("id");if($("#luLevelSwitchHolder li").removeClass("selected").css({"font-weight":"normal"}),"LUprimaryTab"==e)$("#LUprimaryTab").addClass("selected").css({"font-weight":"bold"}),$("#landUseListSec").hide(),$("#landUseList").show(),$("#LUnotesListSec").hide(),$("#LUnotesList").show();else if("LUsecondaryTab"==e){$("#LUsecondaryTab").addClass("selected").css({"font-weight":"bold"}),$("#landUseListSec li").addClass("disabled");var t=$("#landUseList li").index($("#landUseList .selected"));-1!=t&&($("#landUseListSec li:lt("+t+")").removeClass("disabled"),$("#landUseListSec li:gt("+t+")").removeClass("disabled")),$("#landUseList").hide(),$("#landUseListSec").show(),$("#LUnotesList").hide(),$("#LUnotesListSec").show()}}),$("#changeProcessSelection").click(function(e){var t=$(this).next("ul").attr("id");$("#"+t).show(),e.stopPropagation()}),$("#lulc, #changeProcessDiv, #formsDiv").mouseleave(function(){closeDropAndRecord()}),$("#changeProcessList li").click(function(){$("#CPnotesList li").addClass("disabled"),$("#CPnotesList input").attr("disabled",!0),$("#CPnotesList input").prop("checked",!1),$("#changeProcessList li").removeClass("selected");var e=$(this).text();$("td.active").text(e),appendCPnotes(e)}),$("#landUseList li").click(function(){$("#LUnotesList li").addClass("disabled"),$("#LUnotesList input").attr("disabled",!0),$("#LUnotesList input").prop("checked",!1),$("#landUseList li").removeClass("selected");var e=$(this).text();$("td.landUseInput.active").text(e),appendLUnotes(e,"primary")}),$("#landUseListSec li").click(function(){$("#LUnotesListSec li").addClass("disabled"),$("#LUnotesListSec input").attr("disabled",!0),$("#LUnotesListSec input").prop("checked",!1),$("#landUseListSec li").removeClass("selected"),$(this).addClass("selected");var e=$(this).text();appendLUnotes(e,"secondary")}),$("#landCoverList li").click(function(){$("#LCnotesList li").addClass("disabled"),$("#LCnotesList input").attr("disabled",!0),$("#LCnotesList input").prop("checked",!1),$("#landCoverList li").removeClass("selected");var e=$(this).text();$("td.landCoverInput.active").text(e),appendLCnotes(e)}),$(document).ready(function(){$(document).on("click","td.highlightIt",function(){var e=$(this).closest("tr");e.hasClass("active")?(highlightOff(),closeDropAndRecord()):(highlightOff(),closeDropAndRecord(),e.addClass("active"),e.hasClass("segment")?(thisOne=$("tr.segment").index(e),highlightOn("segment",thisOne+1)):(thisOne=$("tr.vertex").index(e),highlightOn("vertex",thisOne)))})}),$("#plotSize").change(function(){var e=$("#plotSize"),t=parseInt(e.prop("value"));switch(t%2==0&&(t+=1),t=Math.min(t,5),t=Math.max(t,1),e.prop("value",t),chipDisplayProps.box=t,$("#plotSizeList").hide(),chipDisplayProps.box){case 1:stopZoom=40;break;case 3:stopZoom=32;break;case 5:stopZoom=27}updateChipInfo(),drawAllChips("annual");var a={action:"plotSize",chipDisplayProps:chipDisplayProps};null!=chipstripwindow&&0==chipstripwindow.closed&&chipstripwindow.postMessage(JSON.stringify(a),"*"),null!=expandedChipWindow&&0==expandedChipWindow.closed&&expandedChipWindow.postMessage(JSON.stringify(a),"*")}),$("#chipSize").change(function(){var e=$("#chipSize"),t=parseInt(e.prop("value"));t%2==0&&(t+=1),t=Math.min(t,255),t=Math.max(t,135),e.prop("value",t),chipDisplayProps.chipSize=t,chipDisplayProps.halfChipSize=t/2,chipDisplayProps.offset=(255-t)/2,chipDisplayProps.canvasHeight=t,$(".chipHolder").remove(),appendChips("annual",selectThese),updateChipInfo(),drawAllChips("annual");var a={action:"chipSize",chipDisplayProps:chipDisplayProps};null!=chipstripwindow&&0==chipstripwindow.closed&&chipstripwindow.postMessage(JSON.stringify(a),"*"),null!=expandedChipWindow&&0==expandedChipWindow.closed&&expandedChipWindow.postMessage(JSON.stringify(a),"*")}),$("#zoomSize").change(function(){var e=$("#zoomSize"),t=parseInt(e.val());t>stopZoom&&(t=stopZoom),minZoom>t&&(t=minZoom),chipDisplayProps.zoomLevel=t,drawAllChips("annual"),zoomInfo={action:"zoom",chipDisplayProps:chipDisplayProps},null!=chipstripwindow&&0==chipstripwindow.closed&&chipstripwindow.postMessage(JSON.stringify(zoomInfo),"*"),null!=expandedChipWindow&&0==expandedChipWindow.closed&&expandedChipWindow.postMessage(JSON.stringify(zoomInfo),"*")}),flickerDir="forward";var vidCntl={isVidPlaying:0,dontPlayVid:0,isFlickerOn:0,dontFlicker:0,speed:300};$(".tlBtn").click(function(){var e=$(this).attr("id"),t=vidCntl.isVidPlaying,a=vidCntl.isFlickerOn;1==vidCntl.isVidPlaying&&(clearInterval(playTL),$("#tlPlay span").attr("class","glyphicon glyphicon-play"),vidCntl.isVidPlaying=0,vidCntl.dontPlayVid=1),1==vidCntl.isFlickerOn&&(clearInterval(flickerTL),$("#tlPlay span").attr("class","glyphicon glyphicon-play"),vidCntl.isFlickerOn=0,vidCntl.dontFlicker=1,flickerDir="forward"),"tlBackx2"==e?(timeLapseIndex+=-2,timeLapseIndex=0>timeLapseIndex?0:timeLapseIndex,drawTLimage(),$("#tlDate").text(data.Values[timeLapseIndex].Year),drawTLimage()):"tlBack"==e&&timeLapseIndex>0?(timeLapseIndex+=-1,drawTLimage(),$("#tlDate").text(data.Values[timeLapseIndex].Year),drawTLimage()):"tlPlay"==e&&0==vidCntl.dontPlayVid?(playTL=setInterval(tlPlay,vidCntl.speed),vidCntl.isVidPlaying=1,$("#tlPlay span").attr("class","glyphicon glyphicon-pause")):"tlForward"==e&&lastIndex>timeLapseIndex?(timeLapseIndex+=1,drawTLimage(),$("#tlDate").text(data.Values[timeLapseIndex].Year),drawTLimage()):"tlForwardx2"==e?(timeLapseIndex+=2,timeLapseIndex=timeLapseIndex>lastIndex?lastIndex:timeLapseIndex,$("#tlDate").text(data.Values[timeLapseIndex].Year),drawTLimage()):"flicker"==e&&0==vidCntl.dontFlicker?(flickerTL=setInterval(tlFlicker,vidCntl.speed),vidCntl.isFlickerOn=1):"faster"==e?(vidCntl.speed=vidCntl.speed>100?vidCntl.speed-50:vidCntl.speed,1==t&&(playTL=setInterval(tlPlay,vidCntl.speed),$("#tlPlay span").attr("class","glyphicon glyphicon-pause"),vidCntl.isVidPlaying=1),1==a&&(flickerTL=setInterval(tlFlicker,vidCntl.speed),vidCntl.isFlickerOn=1)):"slower"==e&&(vidCntl.speed=vidCntl.speed<850?vidCntl.speed+50:vidCntl.speed,1==t&&(playTL=setInterval(tlPlay,vidCntl.speed),$("#tlPlay span").attr("class","glyphicon glyphicon-pause"),vidCntl.isVidPlaying=1),1==a&&(flickerTL=setInterval(tlFlicker,vidCntl.speed),vidCntl.isFlickerOn=1)),vidCntl.dontPlayVid=0,vidCntl.dontFlicker=0}),$(document).on("mousewheel","canvas.annual",function(e){e.shiftKey&&(e.preventDefault(),e.deltaY>0?chipDisplayProps.zoomLevel<maxZoom&chipDisplayProps.zoomLevel<stopZoom&&chipDisplayProps.zoomLevel++:chipDisplayProps.zoomLevel>minZoom&&chipDisplayProps.zoomLevel--,$("#zoomSize").val(chipDisplayProps.zoomLevel),zoomInfo={action:"zoom",chipDisplayProps:chipDisplayProps},drawAllChips("annual"),null!=chipstripwindow&&0==chipstripwindow.closed&&chipstripwindow.postMessage(JSON.stringify(zoomInfo),"*"),null!=expandedChipWindow&&0==expandedChipWindow.closed&&expandedChipWindow.postMessage(JSON.stringify(zoomInfo),"*"))}),$("body").on("click",".expandChipYear",function(e){var t=$(".expandChipYear").index(this),a=$("#selectedColor").prop("value"),s={action:"add_chips",n_chips:chipInfo.chipsInStrip[t],src:chipInfo.src[t],chipIndex:t,chipDisplayProps:chipDisplayProps,useThisChip:chipInfo.useThisChip[t],year:chipInfo.year[t],julday:chipInfo.julday[t],userID:sessionInfo.userID,projectID:sessionInfo.projectID,plotID:sessionInfo.plotID,tsa:sessionInfo.tsa,selectedColor:a};null==chipstripwindow||chipstripwindow.closed?(chipstripwindow=window.open("./chip_qa.php?t="+authHeader+"&a="+Math.floor(8e5*Math.random()),"_blank","width=1080px, height=840px","toolbar=0","titlebar=0","menubar=0","scrollbars=yes"),$(chipstripwindow).on("load",function(){chipstripwindow.postMessage(JSON.stringify(s),"*")})):chipstripwindow.postMessage(JSON.stringify(s),"*")});var trajectoryWindow=null,innerWidth=window.innerWidth;$("body").on("click","#expandTrajPlot",function(e){var t={action:"add_trajectory",data:data,allData:allData,specIndex:specIndex,domain:currentDomain,n_chips:n_chips,selectThese:selectThese,activeRedSpecIndex:activeRedSpecIndex,activeGreenSpecIndex:activeGreenSpecIndex,activeBlueSpecIndex:activeBlueSpecIndex};null==trajectoryWindow||trajectoryWindow.closed?(trajectoryWindow=window.open("./expanded_trajectory_plot.html","_blank","width="+innerWidth+"px, height=750px, toolbar=0, titlebar=0, menubar=0, scrollbars=yes"),$(trajectoryWindow).load(function(){trajectoryWindow.postMessage(JSON.stringify(t),"*")})):trajectoryWindow.postMessage(JSON.stringify(t),"*")});var expandedChipWindow=null;$("#expandChipGallery").click(function(){var e=$("#selectedColor").prop("value"),t={action:"init_chips",selectThese:selectedCircles,chipInfo:chipInfo,n_chips:n_chips,chipDisplayProps:chipDisplayProps,selectedColor:e};null==expandedChipWindow||expandedChipWindow.closed?(expandedChipWindow=window.open("./expanded_chip_gallery.html","_blank","width=1080px, height=840px","toolbar=0","titlebar=0","menubar=0","scrollbars=yes"),$(expandedChipWindow).load(function(){expandedChipWindow.postMessage(JSON.stringify(t),"*")})):expandedChipWindow.postMessage(JSON.stringify(t),"*")});var doyCalWindow=null;$("#doyCalLi").click(function(){(null==doyCalWindow||doyCalWindow.closed)&&(doyCalWindow=window.open("./doy_calendar.html","_blank","width=900px, height=647px, toolbar=0, titlebar=0, menubar=0, scrollbars=yes"))}),$(window).on("message onmessage",function(e){var t=JSON.parse(e.originalEvent.data);if("replace_chip"==t.action)data.Values[t.originChipIndex]=t.data,data=calcDecDate(data),chipInfo.src[t.originChipIndex]=t.src,chipInfo.julday[t.originChipIndex]=t.julday,replaceChip(t),rgbColor=scaledRGB(data,activeRedSpecIndex,activeGreenSpecIndex,activeBlueSpecIndex,stretch,1,n_chips),changePlotPoint(),changeDefaultChip(sessionInfo,year=data.Values[t.originChipIndex].Year,newDOY=t.julday,oldDOY=data.Values[t.originChipIndex].doy);else if("zoom"==t.action)chipDisplayProps.zoomLevel=t.zoomLevel,$("#zoomSize").val(chipDisplayProps.zoomLevel),drawAllChips("annual");else if("mouseEnter"==t.action){var a=allDecdate.indexOf(t.data.decDate);$("circle.allData").eq(a).attr("r",9),$("circle.allData").eq(a).css({stroke:"#19B5FE","stroke-width":5})}else if("mouseLeave"==t.action){var a=allDecdate.indexOf(t.data.decDate);$("circle.allData").eq(a).attr("r",3),$("circle.allData").eq(a).css({"stroke-width":0})}});
